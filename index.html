<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø§Øª - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="login-page" class="page active">
        <div class="login-container">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="button" id="login-button">Ø¯Ø®ÙˆÙ„</button>
                <p id="error-message" class="error-text"></p>
            </form>
        </div>
    </div>

    <div id="dashboard-page" class="page hidden">
        <header>
            <h1 id="welcome-user-text">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
            <button id="logout-button">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </header>
        <main>
            <section id="status-summary">
                </section>
            
            <section id="shipment-list">
                <h2>Ø´Ø­Ù†Ø§ØªÙŠ Ø§Ù„Ù†Ø´Ø·Ø©</h2>
                <button id="go-to-create-shipment">Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø­Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <table id="shipments-table">
                    </table>
            </section>
        </main>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebase/9/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebase/9/firebase-auth.js";

    // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ù‚Ù… Ø¨ØªØ¶Ù…ÙŠÙ†Ù‡Ø§ Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©)
    const firebaseConfig = {
      apiKey: "AIzaSyCIjIjs-2nhLrtssISWc0pNuX2UzxhQ3ZE",
      authDomain: "shipping-tracker-pro.firebaseapp.com",
      projectId: "shipping-tracker-pro",
      storageBucket: "shipping-tracker-pro.firebasestorage.app",
      messagingSenderId: "188119609466",
      appId: "1:188119609466:web:2f2498def75deb9905cbc3",
      measurementId: "G-6V51EXWFMJ"
    };

    // 2. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ (Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† app.js)
    const app = initializeApp(firebaseConfig);
    window.auth = getAuth(app);
    window.onAuthStateChanged = onAuthStateChanged;

    // Note: ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø¹Ù„Ù‰ "window" Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ§Ø­Ø© Ù„Ù…Ù„ÙØ§Øª JS Ø§Ù„Ø£Ø®Ø±Ù‰
</script>

<script>
    // ----------------------------------------------------------------------
    // Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ù„Ù js/auth.js Ø§Ù„Ø¢Ù† ÙÙŠ HTML
    // ----------------------------------------------------------------------

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    async function handleLogin(email, password) {
        // Ù†Ø³ØªØ®Ø¯Ù… window.auth Ùˆ window.firebase Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        const authService = window.auth; 
        const signInWithEmailAndPassword = window.firebase.signInWithEmailAndPassword;

        const errorMessageElement = document.getElementById('error-message');
        if (errorMessageElement) {
            errorMessageElement.textContent = ''; 
            errorMessageElement.style.display = 'none';
        }

        try {
            await signInWithEmailAndPassword(authService, email, password);

        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", error.message);

            let message = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.";
            if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                message = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
            } else if (error.code === 'auth/invalid-email') {
                message = "ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
            } else if (error.code === 'auth/too-many-requests') {
                 message = "ØªÙ… Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¤Ù‚ØªØ§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.";
            }

            if (errorMessageElement) {
                errorMessageElement.textContent = `ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${message}`;
                errorMessageElement.style.display = 'block';
            }
        }
    }

    // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    async function logoutUser() {
        const authService = window.auth;
        const signOut = window.firebase.signOut;
        
        try {
            await signOut(authService);
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:", error.message);
            alert("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.");
        }
    }

    // ----------------------------------------------------------------------
    // Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ù„Ù js/app.js Ø§Ù„Ø¢Ù† ÙÙŠ HTML
    // ----------------------------------------------------------------------
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
    function navigateTo(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
            page.classList.add('hidden');
        });

        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
            targetPage.classList.add('active');
        }
    }

    // ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateDashboardUI(user) {
        const welcomeText = document.getElementById('welcome-user-text');
        if (welcomeText && user) {
            const email = user.email || "Ù…Ø³ØªØ®Ø¯Ù…";
            welcomeText.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${email}`;
        }
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.addEventListener('DOMContentLoaded', () => {
        
        // **ÙØ­Øµ Ø§Ù„ØªØ­Ù…ÙŠÙ„:** Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹!
        alert("ğŸŸ¢ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†! ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©.");
        
        // Ø±Ø¨Ø· Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const loginButton = document.getElementById('login-button');

        if (loginButton) {
            loginButton.addEventListener('click', () => {
                alert("âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø¶ØºØ·Ø© Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©."); 
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                handleLogin(email, password);
            });
        }

        // Ø±Ø¨Ø· Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', logoutUser);
        }

        // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        const createShipmentBtn = document.getElementById('go-to-create-shipment');
        if (createShipmentBtn) createShipmentBtn.addEventListener('click', () => navigateTo('create-shipment-page'));

        const invoicesBtn = document.getElementById('go-to-invoices');
        if (invoicesBtn) invoicesBtn.addEventListener('click', () => navigateTo('invoices-page'));

        const dashboardBtn = document.getElementById('go-to-dashboard');
        if (dashboardBtn) dashboardBtn.addEventListener('click', () => navigateTo('dashboard-page'));

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const authService = window.auth;
        const authStateChanged = window.onAuthStateChanged;

        authStateChanged(authService, (user) => {
            if (user) {
                console.log("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„:", user.uid);
                updateDashboardUI(user);
                navigateTo('dashboard-page');
            } else {
                console.log("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„.");
                navigateTo('login-page');
            }
        });
    });
</script>

</body>
</html>
